<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.enjoyTrip.spot.dao.SpotMapper">

    <!-- getSpot -->
    <select id="getSpotList" parameterType="Map" resultType="getSpotRes">
        select i.attraction_info_id as spotId, title, concat(addr1, ' ', addr2) as address, tel, first_image as image,
               readcount as hit,
               content_type_id as contentId, sido_code as sidoCode,
               gugun_code as gugunCode, latitude as lat,longitude as lon
        from attraction_info i
             left join attraction_detail d on i.attraction_info_id = d.attraction_info_id
        <if test="key != null">
            where
                <if test='key.equals("name") and word != null'>
                    title like concat('%', #{word}, '%') and
                </if>
                <if test='key.equals("type")'>
                    attraction_info_id = #{attractionInfoId} and
                </if>
                <if test='key.equals("region")'>
                    sido_code = #{sidoCode} and
                    <if test='gugunCode != null'>
                        gugun_code = #{gugunCode} and
                    </if>
                </if>
        </if>
    </select>

    <select id="getSpotDetail" parameterType="int" resultType="getSpotRes">
        select i.attraction_info_id as spotId, title, concat(addr1, ' ', addr2) as address, tel,
                first_image as image, readcount as hit,
                content_type_id as contentId, sido_code as sidoCode,
                gugun_code as gugunCode, latitude as lat,longitude as lon,
                d.overview as detail
        from attraction_info i
                left join attraction_detail d on i.attraction_info_id = d.attraction_info_id
        where i.attraction_info_id = #{spotId}
    </select>

    <select id="getSidoList" resultType="SidoDto">
        select sido_code, sido_name
        from sido
    </select>

    <select id="getGugunList" parameterType="int" resultType="GugunDto">
        select gugun_code, gugun_name, sido_code
        from gugun
        where sido_code = #{sidoCode}
    </select>

    <select id="searchSpot" parameterType="string" resultType="getSpotRes">
        select * from attraction_info
        where title Like CONCAT('%', #{word}, '%')
    </select>
</mapper>